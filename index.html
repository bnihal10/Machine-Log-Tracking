<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Production Line Time Tracking System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 UMD -->
 <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <style>html,body,#root{height:100%}.tab{transition:all .15s}</style>
</head>
<body class="bg-gray-100">
<div id="root"></div>

<script>
const {useState,useEffect,useMemo} = React;

/* ====== CONFIG ====== */
// Pilot: single line fixed
const LINE_NAME = "Line 59";

// 1st-level list (from your screenshot)
const L1 = [
  {id:"1",  name:"1. MACHINE_SETUP"},
  {id:"2",  name:"2. WAIT FOR MATERIALS"},
  {id:"3",  name:"3. GRADESTART"},
  {id:"4",  name:"4. GRADECHANGE"},
  {id:"5",  name:"5. GOOD TIME RUNNING"},
  {id:"6",  name:"6. OUT OF SPEC"},
  {id:"7",  name:"7. CONTAMINATION"},
  {id:"8",  name:"8. PROCESS DIFFICULTIES"},
  {id:"9",  name:"9. REPAIRS SCHEDULED"},
  {id:"10", name:"10. REPAIRS UNSCHEDULED"},
  {id:"11", name:"11. DOWNTIME"},
  {id:"12", name:"12. TRIALS"},
  {id:"13", name:"13. WEEKLY DUTIES"},
  {id:"14", name:"14. UNSCHEDULED TIME"},
];

// 2nd-level mapping (cascades by first level)
const L2 = {
  "1":  ["1.1 EQUIPMENT CHANGES","1.2 DURING THE RUN"],
  "2":  ["2.1 FIBER","2.2 SCRIM","2.3 LATEX","2.4 OTHER","2.5 BASE"],
  "3":  ["3.1 GET IN SPEC","3.2 RAW MATERIAL CHANGE","3.3 APPEARANCE"],
  "4":  ["4.1 GET IN SPEC","4.2 RAW MATERIAL CHANGE","4.3 APPEARANCE","4.4 QUICK CHANGE"],
  "5":  ["5.1 CONTINUOUS LOSS"],
  "6":  ["6.1 QC FAIL","6.2 APPEARANCE"],
  "7":  ["7.1 FIBER","7.2 SCRIM or COLLATED ROLL","7.3 OIL","7.4 FOREIGN BODIES"],
  "8":  ["8.1 FIBER FEED","8.2 SCRIM","8.3 EQUIPMENT","8.4 CLEANING","8.5 SLITTING"],
  "9":  ["9.1 FIBER PREP","9.2 PREVENTIVE MAINTENANCE","9.3 WINDER","9.4 INSTRUMENTATION","9.5 CONTROL SYSTEMS","9.6 CARDING","9.7 N/A","9.8 N/A","9.9 UTILITIES AND SERVICE","9.10 SLITTING","9.11 LATEX SYSTEMS","9.12 OVENS","9.13 WAVING UNIT","9.14 N/A","9.15 OTHER EQUIPMENT","9.16 PROJECT WORK"],
  "10": ["10.1 FIBER PREP UNSCHEDULED","10.2 HOIST","10.3 WINDER UNSCHEDULED","10.4 INSTRUMENTATION UNSCHEDULED","10.5 CONTROL SYSTEMS UNSCHEDULED","10.6 CARDING UNSCHEDULED","10.7 WINDER STANDS UNSCHEDULED","10.8 N/A","10.9 UTILITIES AND SERVICE UNSCHEDULED","10.10 SLITTING UNSCHEDULED","10.11 LATEX SYSTEMS UNSCHEDULED","10.12 OVENS UNSCHEDULED","10.13 WAVING UNIT UNSCHEDULED","10.14 N/A","10.15 OTHER EQUIPMENT UNSCHEDULED","10.16 PROCESS ISSUE REPAIR","10.17 MAINTENANCE AVAILABILITY"],
  "11": ["11.1 AIR","11.3 EQUIPMENT CHANGE FOR GRADE","11.4 CREW AVAILABILITY","11.5 POWER OUTAGE","11.6 SAFETY ISSUE","11.7 RUNNABILITY","11.8 OTHER"],
  "12": ["12.1 PRODUCT","12.2 RAW MATERIALS"],
  "13": ["13.1 WARM UP OR COOL DOWN","13.2 CLEAN UP"],
  "14": ["14.1 CREW SCHEDULED","14.2 CREW UNSCHEDULED"],
};

const STORAGE_KEY = "plt_ts_v2"; // bumped for new structure

/* ====== Helpers ====== */
const pad = n => String(n).padStart(2,"0");
const hhmmss = t => t ? `${pad(new Date(t).getHours())}:${pad(new Date(t).getMinutes())}:${pad(new Date(t).getSeconds())}` : "-";
const nowISO = () => new Date().toISOString();
const secsBetween = (a,b) => Math.max(0, Math.floor((new Date(b)-new Date(a))/1000));
const fmtDur = s => `${Math.floor(s/3600)}h ${Math.floor((s%3600)/60)}m ${s%60}s`;

const load = () => { try { return JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]"); } catch(e){ return [] } };
const save = rows => localStorage.setItem(STORAGE_KEY, JSON.stringify(rows));

/* ====== App ====== */
function App(){
  const [tab,setTab] = useState("tracker");
  const [rows,setRows] = useState(load());
  const [tick,setTick] = useState(0);
  useEffect(()=>save(rows),[rows]);
  useEffect(()=>{ const id=setInterval(()=>setTick(t=>t+1),1000); return ()=>clearInterval(id); },[]);

  function addNew(){
    setRows(r=>[
      { id: crypto.randomUUID?.() || Date.now()+Math.random().toString(16).slice(2),
        line: LINE_NAME, l1:"", l2:"", startISO:null, endISO:null, running:false
      }, ...r
    ]);
  }
  function setRow(id, fn){ setRows(rs=>rs.map(r=>r.id===id?fn({...r}):r)); }
  function delRow(id){ setRows(rs=>rs.filter(r=>r.id!==id)); }
  function toggleRun(id){
    setRow(id, r=>{
      if(!r.running){
        // start
        if(!r.l1){ alert("Pick 1st Level"); return r; }
        if(!r.l2){ alert("Pick 2nd Level"); return r; }
        r.startISO = nowISO(); r.endISO = null; r.running = true;
      }else{
        // stop
        r.endISO = nowISO(); r.running = false;
      }
      return r;
    });
  }

  const totals = useMemo(()=>{
    const byL1 = {};
    rows.forEach(r=>{
      const s = r.startISO ? (r.endISO ? secsBetween(r.startISO,r.endISO) : secsBetween(r.startISO,new Date())) : 0;
      if(!r.l1) return;
      byL1[r.l1] = (byL1[r.l1]||0) + s;
    });
    const total = Object.values(byL1).reduce((a,b)=>a+b,0);
    return {byL1,total};
  },[rows,tick]);

  return (
    React.createElement("div",{className:"max-w-5xl mx-auto p-6"},
      React.createElement("div",{className:"text-center mb-4"},
        React.createElement("h1",{className:"text-2xl font-bold"},"Production Line Time Tracking System"),
        React.createElement("p",{className:"text-gray-500"},"Pilot on Line 59 with 1st/2nd level codes")
      ),
      React.createElement("div",{className:"mx-auto max-w-3xl bg-white rounded-full p-1 flex gap-1 mb-6"},
        ["tracker","analytics"].map(t =>
          React.createElement("button",{key:t,onClick:()=>setTab(t),
            className:"tab flex-1 py-2 rounded-full text-sm font-medium "+(tab===t?"bg-gray-900 text-white":"text-gray-600 hover:bg-gray-100")
          }, t==="tracker"?"Time Tracker":"Analytics")
        )
      ),
      tab==="tracker"
        ? React.createElement(Tracker,{rows,setRows,addNew,delRow,toggleRun})
        : React.createElement(Analytics,{rows,totals})
    )
  );
}

function Tracker({rows,setRows,addNew,delRow,toggleRun}){
  useEffect(()=>{ if(rows.length===0) addNew(); },[]);
  function setField(id,key,val){ setRows(rs=>rs.map(r=>r.id===id?({...r,[key]:val}):r)); }

  return (
    React.createElement("div",{className:"bg-white rounded-2xl shadow p-5"},
      React.createElement("div",{className:"flex items-center justify-between mb-3"},
        React.createElement("h2",{className:"font-semibold"},"Line Time Tracking"),
        React.createElement("button",{onClick:addNew,className:"px-4 py-2 rounded-xl bg-gray-900 text-white text-sm"},"Add New Entry")
      ),
      React.createElement("div",{className:"overflow-x-auto"},
        React.createElement("table",{className:"w-full text-sm"},
          React.createElement("thead",null,
            React.createElement("tr",{className:"text-left text-gray-500 border-b"},
              React.createElement("th",{className:"py-2"},"Line"),
              React.createElement("th",{className:"py-2"},"1st Level"),
              React.createElement("th",{className:"py-2"},"2nd Level"),
              React.createElement("th",{className:"py-2"},"Start Time"),
              React.createElement("th",{className:"py-2"},"End Time"),
              React.createElement("th",{className:"py-2"},"Duration"),
              React.createElement("th",{className:"py-2 text-right"},"Actions")
            )
          ),
          React.createElement("tbody",null,
            rows.map(r=>{
              const optionsL2 = r.l1 ? L2[r.l1] : [];
              const dur = r.startISO ? (r.endISO ? secsBetween(r.startISO,r.endISO) : secsBetween(r.startISO,new Date())) : 0;
              return React.createElement("tr",{key:r.id,className:"border-b last:border-0 align-middle"},
                // Line (fixed)
                React.createElement("td",{className:"py-2 pr-2"},
                  React.createElement("div",{className:"px-3 py-2 rounded-lg bg-gray-100 border inline-block"}, LINE_NAME)
                ),
                // 1st Level
                React.createElement("td",{className:"py-2 pr-2"},
                  React.createElement("select",{
                    value:r.l1, onChange:e=>{ const v=e.target.value; setField(r.id,"l1",v); setField(r.id,"l2",""); },
                    className:"rounded-lg border p-2"
                  },
                    React.createElement("option",{value:""},"Select 1st Level"),
                    L1.map(x=>React.createElement("option",{key:x.id,value:x.id},x.name))
                  )
                ),
                // 2nd Level (depends on 1st)
                React.createElement("td",{className:"py-2 pr-2"},
                  React.createElement("select",{
                    value:r.l2, onChange:e=>setField(r.id,"l2",e.target.value),
                    className:"rounded-lg border p-2", disabled: !r.l1
                  },
                    React.createElement("option",{value:""},"Select 2nd Level"),
                    optionsL2.map(s=>React.createElement("option",{key:s,value:s},s))
                  )
                ),
                // Start / End / Duration
                React.createElement("td",{className:"py-2"}, hhmmss(r.startISO)),
                React.createElement("td",{className:"py-2"}, hhmmss(r.endISO)),
                React.createElement("td",{className:"py-2"}, r.startISO ? fmtDur(dur) : "-"),
                // Actions
                React.createElement("td",{className:"py-2 text-right"},
                  React.createElement("div",{className:"inline-flex gap-2"},
                    React.createElement("button",{
                      onClick:()=>toggleRun(r.id),
                      className:"px-3 py-1.5 rounded-lg "+(r.running?"bg-yellow-500 text-white":"bg-gray-700 text-white")
                    }, r.running ? "Stop" : "Go"),
                    React.createElement("button",{
                      onClick:()=>delRow(r.id),
                      className:"px-3 py-1.5 rounded-lg border hover:bg-red-50"
                    },"Delete")
                  )
                )
              )})
          )
        )
      )
    )
  );
}

function Analytics({rows, totals}){
  const byL1 = useMemo(()=>{
    const m = {};
    rows.forEach(r=>{
      if(!r.l1 || !r.startISO) return;
      const s = r.endISO ? secsBetween(r.startISO,r.endISO) : secsBetween(r.startISO,new Date());
      m[r.l1] = (m[r.l1]||0) + s;
    });
    // Label with full L1 name
    const nameOf = id => (L1.find(x=>x.id===id)?.name || id);
    return Object.entries(m).map(([id,sec]) => [nameOf(id), sec]).sort((a,b)=>a[0].localeCompare(b[0]));
  },[rows]);

  return (
    React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},
      React.createElement("div",{className:"bg-white rounded-2xl shadow p-5"},
        React.createElement("h3",{className:"font-semibold mb-3"},"Totals by 1st Level"),
        React.createElement("ul",{className:"space-y-2"},
          byL1.length ? byL1.map(([name,sec]) =>
            React.createElement("li",{key:name,className:"flex justify-between"},
              React.createElement("span",null,name),
              React.createElement("span",{className:"font-medium"}, fmtDur(sec))
            )
          ) : React.createElement("li",{className:"

